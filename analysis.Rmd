---
title: "Auditory Mountain"
output:
  html_document:
    toc: yes
date: "`r format(Sys.time(), '%B %d %Y')`"
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.path='figures/')
options("scipen"=100, "digits"=2)
```


```{r initialization, echo=FALSE, message=FALSE, warning=FALSE}
library("rjson")
library("ggplot2")
library("gridExtra")
library("zoo")
library("RColorBrewer")
require(gridExtra)
require(zoo)
library(devtools)
library(reshape2)
library(scales)
```

```{r preProc, include=F}
# Pre processing of the data from the first design
source("R/preProcFirstDesign.R")
```

```{r thresholds, include=F, echo=FALSE, message=FALSE, warning=FALSE}
# Check if there are frequency threshold data
if ('deltaF' %in% names(data)) {
  source("R/threshold.R")
}
```

```{r mountain, include=F, echo=FALSE, message=FALSE, warning=FALSE}
# Check if there is any mountain trial
if ('targetTone' %in% names(data)) {
  # Check if there is any yAxis trial
  if ('yAxis' %in% data$condition) {
    source("R/yAxis.R")
  }

  # Check if there is any lines trial
  if ('lines' %in% data$condition) {
    source("R/lines.R")
  }
  
  # Check if there is any circles trial
  if ('circles' %in% data$condition) {
    source("R/circles.R")
  }
}
```

```{r longitudinal, include=F, echo=FALSE, message=FALSE, warning=FALSE}
source("R/longitudAnalysis.R")
```


# Individual analyses

## Frequency threshold task

The frequency thresholds are calculated from an adaptive procedure where deltaF is decreased when a wrong answer is provided and increased for a right answer.

### Detection and identification deltaF

The evolution of the delta F values across trials for the detection and identification tasks is ploted bellow:

```{r plotDeltaF, echo=FALSE, message=FALSE, warning=FALSE, fig.height=15}

plotDeltaF

```

### Thresholds

#### Each participant among sessions

The thresholds are calculated from the DeltaF values corresponding to the last 10 reversals. The procedure was repeated two times before training (sessions 1 and 2) and two times after (sessions 3 and 4). The figure bellow shows these thresholds across sessions for the detection and identification conditions:    

```{r plotThresholds, echo=FALSE, message=FALSE, warning=FALSE, fig.height=20}

plotThresholds

```

#### Each participant among sessions in percent of the first session

```{r plotThresholdsPercent, echo=FALSE, message=FALSE, warning=FALSE, fig.height=20}

plotThresholdsPercent

```

### Detection threshold in function of identification threshold

#### For each session

```{r plotDetById, echo=FALSE, message=FALSE, warning=FALSE}

plotDetById

```

#### Pre vs. post tests

The threshold scores are the means of the four session (two pre-test and two post-test)

```{r plotDetByIdPrepost, echo=FALSE, message=FALSE, warning=FALSE}

plotDetByIdPrepost

```

#### First vs. second tests

```{r plotDetByIdPrepre, echo=FALSE, message=FALSE, warning=FALSE}

plotDetByIdPrepre

```

## Auditory mountain task

Here are the plots of scores, accuracy and duration in function of trials. The accuracy is the difference between the choosen tone and the highest tone. The duration is the length in seconds of each trial from the begining of the sound to the answer. The score is a mixed value calculated from accuracy and duration according to this equation:

$$ (\frac{1}{(\frac{duration}{100}+1)^2} + 1) \times 600 \times (\frac{accuracy}{100})^2 $$

***

Thus, the time score is a multiplier between 1 for a very long trial and 2 for a very short one (few seconds). Thus, the accuracy score can be doubled with speed. 

The accuracy score is 600 maximum (the idea was to make a score in order to have the pleasure to cross 1000 points when the performance is good). For accuracy and time, the power function is used to provide the maximum of points near the perfect score and have a lot of difference when it is harder.

UPDATE:

The equation used from va01 (20/07/15) was modified to have a more steeper curve and invite people to be more accurate and avoid the strategy to make a lot of trial quickly and win a lot of points:

$$ (\frac{1}{(\frac{duration}{100}+1)^2} + 1) \times 600 \times (\frac{accuracy}{100})^6 $$

### Participant's scores

```{r plotScores, echo=FALSE, message=FALSE, warning=FALSE, fig.height=15}

plotScores

```

### Accuracy of trials

```{r plotAcc, echo=FALSE, message=FALSE, warning=FALSE, fig.height=15}

plotAcc

```

### Durations of trials

```{r plotDur, echo=FALSE, message=FALSE, warning=FALSE, fig.height=15}

plotDur

```

### Accuracy in function of duration for each trial

The variability of the results is not associated with duration. Each point is a trial.

```{r plotAccByDur, echo=FALSE, message=FALSE, warning=FALSE}

plotAccByDur

```

### Accuracy in function of frequency of the target tone

The frequencies used in the mountain task are randomly taken from 400 Hz to 2400 Hz.

```{r plotAccByFreq, echo=FALSE, message=FALSE, warning=FALSE}

plotAccByFreq

```

### Comparison of frequency thresholds and accuracy

```{r plotAccThresh, echo=FALSE, message=FALSE, warning=FALSE, fig.height=15}

plotAccThresh +
  geom_hline(aes(yintercept=(2^(threshold/1200)-1)*100,
                   linetype=condition),
               meanThresholdsSubjLong,
               show_guide=TRUE) +
  guides(linetype = guide_legend("Frequency thresholds"))

```


# Global analyses

## Frequency threshold task

```{r plotDeltaFMeans, echo=FALSE, message=FALSE, warning=FALSE}

# plotDeltaFMeans

```

### Mean of thresholds among sessions

The mean thresholds are calculated from all participant's deltaF for each session (first and second in pre-test and third and fourth in post-test) and condition (detection and identification).


```{r plotMeanThresholds, echo=FALSE, message=FALSE, warning=FALSE}

plotMeanThresholds

```

### Mean of thresholds among sessions in percent of the first session

Thresholds are also calculated in percent of the first session deltaF.

```{r plotMeanThresholdsPercent, echo=FALSE, message=FALSE, warning=FALSE}

plotMeanThresholdsPercent

```

# Longitudinal analysis

The equation used to calculate the total score take into account the global scores to the mountain task of each session, the mean accuracy of all mountain task sessions and the results to each threshold tasks:

$$ ScoreTotal + (1000 \times meanAccuracy) + \frac{20 000 000}{deltaFIdentification} + \frac{20 000 000}{deltaFDetection} $$

```{r competScore, include=FALSE, echo=FALSE, message=FALSE, warning=FALSE}

competScore_va01 <- round(sum(totalScoresLong$totalScore[totalScoresLong$name=="va01"]), 0) + 1000 * meanAccuracy$meanAcc[meanAccuracy$name=="va01"] + 20000000 / mean(thresholdsLongiAllLong$threshold[thresholdsLongiAllLong$name=="va01" & thresholdsLongiAllLong$condition=="identification"]) + 20000000 / mean(thresholdsLongiAllLong$threshold[thresholdsLongiAllLong$name=="va01" & thresholdsLongiAllLong$condition=="detection"])

competScore_df22 <- round(sum(totalScoresLong$totalScore[totalScoresLong$name=="df22"]), 0) + 1000 * meanAccuracy$meanAcc[meanAccuracy$name=="df22"] + 20000000 / mean(thresholdsLongiAllLong$threshold[thresholdsLongiAllLong$name=="df22" & thresholdsLongiAllLong$condition=="identification"]) + 20000000 / mean(thresholdsLongiAllLong$threshold[thresholdsLongiAllLong$name=="df22" & thresholdsLongiAllLong$condition=="detection"])

```

#### va01:

$$ `r sum(totalScoresLong$totalScore[totalScoresLong$name=="va01"])` + (1000 \times `r meanAccuracy$meanAcc[meanAccuracy$name=="va01"]`) + \frac{20 000 000}{`r mean(thresholdsLongiAllLong$threshold[thresholdsLongiAllLong$name=="va01" & thresholdsLongiAllLong$condition=="identification"])`} + \frac{20 000 000}{`r mean(thresholdsLongiAllLong$threshold[thresholdsLongiAllLong$name=="va01"
& thresholdsLongiAllLong$condition=="detection"])`} = `r competScore_va01` $$

#### df22:
$$ `r sum(totalScoresLong$totalScore[totalScoresLong$name=="df22"])` + (1000 \times `r meanAccuracy$meanAcc[meanAccuracy$name=="df22"]`) + \frac{20 000 000}{`r mean(thresholdsLongiAllLong$threshold[thresholdsLongiAllLong$name=="df22" & thresholdsLongiAllLong$condition=="identification"])`} + \frac{20 000 000}{`r mean(thresholdsLongiAllLong$threshold[thresholdsLongiAllLong$name=="df22" & thresholdsLongiAllLong$condition=="detection"])`} = `r competScore_df22` $$

## Frequency threshold task

The frequency threshold tests are done before and after each training session. The dotted vertical lines correspond to each first threshold task.

```{r plotThresholdsLongi, echo=FALSE, message=FALSE, warning=FALSE}

plotThresholdsLongi

```

## Auditory mountain task

### Participant's scores

```{r plotScoresLongi, echo=FALSE, message=FALSE, warning=FALSE}

plotScoresLongi

```

### Accuracy of trials

```{r plotAccLongi, echo=FALSE, message=FALSE, warning=FALSE}

plotAccLongi

```

### Durations of trials

```{r plotDurLongi, echo=FALSE, message=FALSE, warning=FALSE}

plotDurLongi

```

# Session info

```{r session_info, include=TRUE, echo=TRUE, results='markup'}
devtools::session_info()
```
  