---
title: "Auditory Mountain"
output:
  html_document:
    css: style.css
    toc: yes
  pdf_document:
    toc: yes
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.path='figures/')
options("scipen"=100, "digits"=2)
```


```{r initialization, echo=FALSE, message=FALSE, warning=FALSE}
library("rjson")
library("ggplot2")
library("gridExtra")
library("zoo")
library("RColorBrewer")
require(gridExtra)
require(zoo)
library(devtools)
library(reshape2)
library(scales)
library(dplyr)
```

```{r preProc, include=F}
# Pre processing of the data from the first design
source("R/preProcFirstDesign.R")
```

```{r thresholds, include=F, echo=FALSE, message=FALSE, warning=FALSE}
# Check if there are frequency threshold data
if ('deltaF' %in% names(data)) {
  source("R/threshold.R")
}
```

```{r mountain, include=F, echo=FALSE, message=FALSE, warning=FALSE}
# Check if there is any mountain trial
if ('targetTone' %in% names(data)) {
  # Check if there is any yAxis trial
  if ('yAxis' %in% data$condition) {
    source("R/yAxis.R")
  }

  # Check if there is any lines trial
  if ('lines' %in% data$condition) {
    source("R/lines.R")
  }
  
  # Check if there is any circles trial
  if ('circles' %in% data$condition) {
    source("R/circles.R")
  }
}
```

```{r longitudinal, include=F, echo=FALSE, message=FALSE, warning=FALSE}
source("R/longitudAnalysis.R")
```

# Analyses individuelles

## Seuils fréquentiels

Les seuils fréquentiels sont évalués à l'aide de la tâche de Semal & Demany (2006) dans laquelle quatre sons sont présentés organisés en deux paires. Dans la condition détection, le sujet doit dire quelle paire contient deux sons différents (première ou seconde) et dans la condition identification, il doit dire si les sons différents forment un contour ascendant ou descendant.

Il s'agit d'une procédure adaptative dans laquelle la difficulté augmente lorsque le participant réussit et diminue lorsqu'il fait erreur. A chaque fois qu'une bonne réponse est suivie d'une mauvaise ou qu'une mauvaise est suivie d'une bonne, la valeur du deltaF est considérée comme un "reversal". La tâche s'arrête lorsque 10 reversals sont comptabilisés (les résultats préliminaires correspondant à la tâche réalisée avec 14 reversals ont laissé penser que les valeurs étaient stables au bout de 10).

Pour un certain nombre de participants, les valeurs du deltaF ne se resserrent pas mais deviennent de plus en plus larges. Le calcul du seuil est-il tout de même valable pour ces individus ?

```{r plotDeltaF, echo=FALSE, message=FALSE, warning=FALSE, , fig.height=length(levels(factor(raw.data$name)))*1.2}

plotDeltaF

```

Les seuils fréquentiels sont ensuite calculés à partir de la moyenne des 6 derniers reversals. 

Cette mesure du seuil est réalisée deux fois pré-test puis deux fois post-test.

Les valeurs des seuils pour ces quatre sessions dans les conditions détection et identification pour chaque participant sont présentées sur les figure suivantes :
 
```{r plotThresholds, echo=FALSE, message=FALSE, warning=FALSE}

plotThresholds

```

Cette seconde figure présente les même seuils mais en pourcentage de la première session. 

Une seconde question concerne la manière idéale de représenter ces seuils.

```{r plotThresholdsPercent, echo=FALSE, message=FALSE, warning=FALSE}

plotThresholdsPercent

```

### Seuils de détection en fonction des seuils d'identification

#### Pré vs. post tests

Les seuils de détection sont ici comparés aux seuils d'identification. Dans ce graphique, les cercles pleins correspondent aux seuils pré-test moyennés ensembles et les cercles vides aux seuils post-test moyennés ensembles. Cela permet de mettre en évidence l'effet éventuel de l'entraînement réalisé entre les sessions pré et post-test (donc entre les sessions 2 et 3) sur les seuils perceptifs.

Ainsi, des flèches se dirigeant vers le bas indiquent une amélioration du seuil d'identification (correspondant à la tâche "ascendant vs. descendant") et des flèches se dirigeant vers la gauche indiquent une amélioration du seuil de détection (correspondant à la tâche "première vs deuxième paire").

```{r plotDetByIdPrepost, echo=FALSE, message=FALSE, warning=FALSE}

plotDetByIdPrepost

```

\ref{fig:plotDetByIdPrepost}

Dans ce second graphique, les seuils des sessions 1 et 3 (premiers seuils des mesures pré et post-test) sont moyennées ensembles et les seuils des sessions 2 et 4 ensembles (seconds seuils de chaque mesure). Cela permet de mettre en avant l'éventuelle progression des seuils liée à la répétition de la tâche et non à l'entraînement.

```{r plotDetByIdPrepre, echo=FALSE, message=FALSE, warning=FALSE}

plotDetByIdPrepre

```

## Entraînement : Auditory Mountain

Entre les mesures de seuils fréquentiels pré et post-test, les participants ont réalisé une tâche d'entraînement pendant une demi-heure. Cette tâche consiste à déplacer verticalement le stylet sur la tablette de manière à trouver le son le plus aigu, choisi aléatoirement entre 400 Hz et 2400 Hz. Par exemple, un déplacement sur toute la hauteur de la zone produit un son pur continu ascendant jusqu'au son cible puis descendant. Le participant doit ainsi trouver le point qui correspond à ce changement de contour mélodique.

Selon sa précision et sa rapidité, le sujet gagne des points qui se cumulent d'un essai à l'autre. Le but est de remporter le plus grand nombre de points pendant la demi-heure de test.

Les scores sont calculés selon cette équation :

$$ (\frac{1}{(\frac{duration}{100}+1)^2} + 1) \times 600 \times (\frac{accuracy}{100})^2 $$


De cette manière la rapidité permet de multiplier le score de précision jusqu'à deux fois. Malgré ce rôle de la rapidité, la majorité des points sont gagnés grâce à la précision de la réponse. 


### Précision des participants

Ces graphiques montrent les résultats de chaque participant à la tâche d'entraînement. La précision est en pourcentage d'erreur et correspond à la différence entre le son choisi comme étant le plus aigu et le son cible. Ainsi, un résultat de 0 pourcent correspond à avoir trouvé exactement le son cible. Une moyenne glissante a également été calculée sur une fenêtre de 10 valeurs.


```{r plotAcc, echo=FALSE, message=FALSE, warning=FALSE}

plotAcc

```

### Comparaison des seuils fréquentiels et de la précision à la tâche d'entraînement

Il est intéressant de comparer les scores des participants aux tâches de calcul de seuils fréquentiels pré et post-test avec leurs scores à la tâche d'entraînement (trouver le son le plus aigu).

Pour cela, les seuils fréquentiels en cents sont converti en pourcentage de la manière suivante :

$$ (2^\frac{seuil}{1200}-1) \times 100 $$

Ils sont ensuite représentés superposés aux scores obtenus à la tâche d'entraînement (elle-même en pourcentage) de manière à comparer la capacités des participants dans ces deux types de tâches.

On constate que les capacités perceptives fréquentielles des participants semblent meilleures dans le cadre de la tâche d'entraînement, notamment si l'on compare avec les seuils d'identification (pointillés).

Pourtant, on peut penser que la tâche d'entraînement nécessite l'identification du contour mélodique et non seulement la détection d'un changement de son. En effet, le son change continuellement lors du déplacement du stylet sur la tablette et seul le changement de contour représente un indice de la position de la cible.

```{r plotAccThresh, echo=FALSE, message=FALSE, warning=FALSE, fig.height=length(levels(factor(raw.data$name)))*1.1}

plotAccThresh +
  geom_hline(aes(yintercept=(2^(threshold/1200)-1)*100,
                   linetype=condition),
               meanThresholdsSubjLong,
               show_guide=TRUE) +
  guides(linetype = guide_legend("Frequency thresholds"))

```

### Précision en fonction de la durée des essais

Il ne semble pas exister de corrélation entre le temps pris pour résoudre la tâche et la précision. On aurait pourtant pu attendre un lien entre ces variables. Il est possible que les participants prennent le temps nécessaire à répondre de manière précise et qu'une corrélation aurait pu être observée si une limite de temps avait été donnée.


```{r plotAccByDur, echo=FALSE, message=FALSE, warning=FALSE}

plotAccByDur

```

### Précision en fonction de la fréquence du son cible

Il ne semble pas non plus exister de lien entre la réussite à cette tâche et la fréquence du son le plus aigu qui constitue la cible.

```{r plotAccByFreq, echo=FALSE, message=FALSE, warning=FALSE}

plotAccByFreq

```

# Analyses globales

## Seuils fréquentiels

```{r plotDeltaFMeans, echo=FALSE, message=FALSE, warning=FALSE}

# plotDeltaFMeans

```

### Moyenne des participants

Les seuils fréquentiels des participants sont ici moyennés et présentés en fonction de la session (1 et 2 correspondant aux pré-test et 3 et 4 aux post-test).


```{r plotMeanThresholds, echo=FALSE, message=FALSE, warning=FALSE}

plotMeanThresholds

```

### Moyenne des participants en pourcentage de la première session


```{r plotMeanThresholdsPercent, echo=FALSE, message=FALSE, warning=FALSE}

plotMeanThresholdsPercent

```

## Auditory Mountain task

### Moyenne des performances de précision de tous les participants

Seulement deux participants ont eu le temps de faire plus de 100 essais. Seuls les 75 premiers essais doivent être considérés car tous les participants ont eu le temps (en 30 minutes) de réaliser ce nombre d'essai. On peut observer une amélioration moyenne pendant les 30 premiers essais. Il est pour le moment difficile de dire si cette amélioration est procédurale est liée à la familiarité à la tâche où si elle concerne la perception auditive.

```{r plotAccMean, echo=FALSE, message=FALSE, warning=FALSE}

plotAccMean

```

# Analyse longitudinale

Deux participants (va01 et df22) ayant réalisé l'expérience ont été invités à faire quatre sessions supplémentaires sur quatre jours. Les sessions ont été identiques à la première (pré-test, entraînement, post-test) mais une motivation supplémentaire à été introduite (gain de 10 euros pour le plus performant, tenant compte des scores de seuils et de la tâche d'entraînement).

## Seuils fréquentiels

### Données individuelles

Pour ces deux participants, les seuils fréquentiels calculés à chaque session sont présentés (5 sessions comprenant quatre calculs de seuil à chaque fois, deux avant l'entraînement et deux après). Les lignes pointillées correspondent donc au premier calcul de seuil de chaque journée.

```{r plotThresholdsLongi, echo=FALSE, message=FALSE, warning=FALSE}

plotThresholdsLongi

```

#### Moyenne

```{r plotThresholdsLongiMean, echo=FALSE, message=FALSE, warning=FALSE, fig.height=3}

plotThresholdsLongiMean

```

### Données individuelles en pourcentage de la première session

```{r plotThresholdsLongiPercent, echo=FALSE, message=FALSE, warning=FALSE}

plotThresholdsLongiPercent

```

### Moyenne en pourcentage de la première session

```{r plotMeanThresholdsLongiPercent, echo=FALSE, message=FALSE, warning=FALSE, fig.height=3}

plotMeanThresholdsLongiPercent

```

## Entraînement : Auditory Mountain

Enfin, la totalité des essais d'entraînement (tâche où les participants devaient trouver le son le plus aigu) sont ici représentés.

### Précision des participants

On constate qu'un participant n'a eu le temps de faire qu'environ 300 essais en 5 fois une demi-heure contre plus de 500 pour le second.

```{r plotAccLongi, echo=FALSE, message=FALSE, warning=FALSE}

plotAccLongi

```
